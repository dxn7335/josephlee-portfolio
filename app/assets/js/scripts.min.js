/*!
 * josephlee-portfolio
 * Joseph Lee - UX/Visual Designer
 * http://getfireshell.com
 * @author Danny Nguyen
 * @version 1.0.0
 * Copyright 2015. MIT licensed.
 */
'use strict';

// Main Router /////////////////////////////////////////////////////////////////////////////
var app = angular.module('App', 
		['ui.router', 
		 'home.controller', 
		 'work.controller',
		])
		.config(function ( $stateProvider, $urlRouterProvider, $locationProvider ) {
			'use strict';
			// configure urls
			$urlRouterProvider.when('/work', '/');
			$urlRouterProvider.otherwise('/');
			
			// Check browser if history API is available
			// if so, route without #
			if( Modernizr.history ){
				$locationProvider.html5Mode(true);
			}
			
			//state
			$stateProvider
				.state('work', {
					url: '/work/:id',
					views:{
							'work-sect':{
									'templateUrl': function($stateParams){
										console.log($stateParams.id);
										return 'assets/templates/'+$stateParams.id+".html";
									},
									'controller': 'workController', // map js to html scope
							},
					}
				})
				.state('home',{
					url: "/",
					views:{
							'home':{
									templateUrl: 'assets/templates/home.html',
									controller: 'homeController', // map js to html scope
							}
					}
				});
		});
// Main Service for Work Data //////////////////////////////////
// Pulls in list of work
angular.module('data.service', [])
		.service('dataService', [ '$q','$http', function($q, $http){
			this.promise = null;
	
			function makeRequest() {
					 return $http.get('assets/data/workConfig.json')
							 .then(function(resp){
										return resp.data;
							 });
			}
		
			//will only get data if no call has been made already
			this.getPromise = function(update){
				if (update || !this.promise) {
					 this.promise = makeRequest();
				}
				return this.promise;      
			}
		}]);

//Home Controller /////////////////////////////////////////////////////////////////////////////
angular.module('home.controller', ['data.service'])

    .controller('homeController', [
        '$scope', '$sce', '$stateParams', 'dataService',
        function ($scope, $sce, $stateParams, dataService){
        	$scope.works = [];
					
					//Make sure works list has been loaded
					dataService.getPromise().then(function(data){
						//when data is loaded
						$scope.works = data.works;
						console.log($scope.works);
					}, function(err){
						console.log(err);
					});
					
    }]);
//Work Controller /////////////////////////////////////////////////////////////////////////////
angular.module('work.controller', [])

    .controller('workController', [
        '$scope', '$sce', '$stateParams',
        function ($scope, $sce, $stateParams){
        
    }]);
//Work Navigation Controller /////////////////////////////////////////////////////////////////////////////
// Used to navigate between project pages
angular.module('home.controller', ['data.service'])

    .controller('homeController', [
        '$scope', '$sce', '$stateParams', 'dataService',
        function ($scope, $sce, $stateParams, dataService){
        	$scope.works = [];
					
					//Make sure works list has been loaded
					dataService.getPromise().then(function(data){
						//when data is loaded
						$scope.works = data.works;
						console.log($scope.works);
					}, function(err){
						console.log(err);
					});
					
					// Find current index in works array
					
					// create links for viewing previous or next proj
					// (if no prev or no next proj), don't show link
					$scope.prev = {};
					$scope.next = {};
    }]);